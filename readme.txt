=== Secure Freelancer Access ===
Contributors: air900
Tags: permissions, roles, access control, editor, pages
Requires at least: 5.8
Tested up to: 6.9
Stable tag: 2.0.3
Requires PHP: 7.4
License: GPLv2 or later
License URI: https://www.gnu.org/licenses/gpl-2.0.html

Ограничение доступа редакторов к конкретным страницам и записям в админ-панели WordPress.

== Description ==

**Secure Freelancer Access** — плагин для точечного управления доступом пользователей с ролью Editor к страницам и записям в административной панели WordPress.

= Проблема =

По умолчанию пользователи с ролью Editor (Редактор) видят ВСЕ страницы и записи на сайте. Это создает проблемы, когда нужно дать доступ верстальщику или внешнему специалисту только к конкретным страницам.

= Решение =

Плагин позволяет администратору настроить, какие именно страницы и записи видит каждый редактор:
* В списках админ-панели отображаются только разрешенные элементы
* Прямой доступ по URL к запрещенным страницам блокируется (403 Forbidden)
* Ведется журнал попыток несанкционированного доступа

= Основные возможности =

* ✅ Ограничение доступа к конкретным страницам (Pages)
* ✅ Ограничение доступа к конкретным записям (Posts)
* ✅ Блокировка прямого доступа по URL (403 Forbidden)
* ✅ Фильтрация выпадающих списков (родительские страницы)
* ✅ Журнал попыток несанкционированного доступа
* ✅ Удобный интерфейс с чекбоксами и поиском
* ✅ Безопасность (nonce, валидация, санитизация)
* ✅ Полностью протестирован (unit-тесты)

= Как это работает =

1. Администратор заходит в `Параметры → Ограничение доступа`
2. Выбирает пользователя с ролью Editor
3. Отмечает разрешенные страницы и записи
4. Сохраняет настройки
5. Редактор видит в админке только разрешенные элементы!

= Кому подходит =

* Агентствам, работающим с внешними верстальщиками
* Владельцам сайтов с несколькими редакторами
* Проектам, где нужен гранулярный контроль доступа
* Всем, кто хочет ограничить видимость контента для определенных пользователей

= Техническая информация =

Плагин использует три механизма защиты:
1. Фильтр `pre_get_posts` — скрывает недоступные посты из списков
2. Хук `load-post.php` — блокирует прямой доступ к редактору
3. Фильтр `page_attributes_dropdown_pages_args` — фильтрует выпадающие списки

Данные хранятся в `wp_usermeta` для каждого пользователя.

== Installation ==

= Автоматическая установка =

1. Зайдите в `Плагины → Добавить новый`
2. В поиске введите "Secure Freelancer Access"
3. Нажмите "Установить" и затем "Активировать"

= Ручная установка =

1. Загрузите ZIP-архив плагина
2. Распакуйте в папку `/wp-content/plugins/secure-freelancer-access/`
3. Активируйте плагин в разделе `Плагины` админ-панели WordPress

= Настройка =

1. После активации перейдите в `Параметры → Ограничение доступа`
2. Выберите пользователя-редактора из списка
3. Нажмите "Редактировать доступ"
4. Отметьте галочками разрешенные страницы и записи
5. Сохраните изменения

== Frequently Asked Questions ==

= Влияет ли плагин на администраторов? =

Нет. Администраторы (с правом `manage_options`) видят все страницы и записи без ограничений. Плагин применяется только к пользователям с ролью Editor и ниже.

= Можно ли ограничить доступ к Custom Post Types? =

В текущей версии (1.0.0) поддерживаются только стандартные Pages и Posts. Поддержка Custom Post Types планируется в следующих версиях.

= Что произойдет, если редактор попытается открыть запрещенную страницу по прямой ссылке? =

Плагин заблокирует доступ и покажет сообщение "Доступ запрещен" (HTTP 403). Попытка доступа будет записана в журнал.

= Где хранятся настройки доступа? =

Данные хранятся в таблице `wp_usermeta`:
* `rpa_allowed_pages` — массив ID разрешенных страниц
* `rpa_allowed_posts` — массив ID разрешенных записей

Журнал доступа хранится в `wp_options` как `rpa_access_logs`.

= Работает ли плагин с Elementor? =

Да, плагин совместим с Elementor и другими page builders.

= Как удалить все данные плагина? =

При деактивации данные НЕ удаляются автоматически. Для полной очистки выполните в консоли:

`
delete_metadata('user', 0, 'rpa_allowed_pages', '', true);
delete_metadata('user', 0, 'rpa_allowed_posts', '', true);
delete_option('rpa_access_logs');
`

= Плагин замедляет сайт? =

Нет. Плагин работает только в админ-панели и не влияет на фронтенд. Все запросы оптимизированы.

== Screenshots ==

1. Главная страница - список всех редакторов с информацией о доступе
2. Форма редактирования доступа для конкретного пользователя
3. Журнал попыток несанкционированного доступа
4. Редактор видит только разрешенные страницы в списке
5. Сообщение об ошибке 403 при попытке доступа к запрещенной странице

== Changelog ==

= 1.0.0 (2025-12-15) =
* Первый публичный релиз
* Базовая функциональность (MVP)
* Ограничение доступа к страницам и записям
* Административный интерфейс с чекбоксами
* Журнал доступа с информацией о попытках
* Полный набор unit-тестов
* Безопасность согласно WordPress стандартам

== Upgrade Notice ==

= 1.0.0 =
Первый релиз плагина. Установите и настройте доступ для ваших редакторов!

== Additional Info ==

= Безопасность =

Плагин следует всем рекомендациям WordPress по безопасности:
* Nonce проверки для всех форм
* Валидация и санитизация данных
* Проверка прав доступа
* Защита от SQL-инъекций
* Защита от XSS

= Производительность =

* Минимальное влияние на производительность
* Работает только в админ-панели
* Оптимизированные запросы к БД
* Не влияет на фронтенд сайта

= Поддержка =

Если у вас возникли вопросы или проблемы:
1. Проверьте раздел FAQ
2. Убедитесь в соответствии версий WordPress и PHP требованиям
3. Включите режим отладки (`WP_DEBUG`)
4. Создайте issue в репозитории

= Дорожная карта =

Версия 1.1 (планируется):
* Локализация (русский/английский)
* REST API фильтры
* AJAX-поиск страниц
* Кэширование

Версия 1.2 (планируется):
* Поддержка Custom Post Types
* Групповое управление правами
* Экспорт/импорт настроек

Версия 2.0 (планируется):
* Интеграция с Elementor
* Ограничения по таксономиям
* Временные ограничения доступа
